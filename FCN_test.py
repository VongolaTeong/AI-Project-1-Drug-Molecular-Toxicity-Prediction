#source file for recovering the network model

import numpy as np
import tensorflow as tf
from FCN_train import createModel

#read names from file
names = np.genfromtxt("test/names_smiles.txt", dtype=str, delimiter = ',', skip_header = 1, usecols = (0))
    
#read onehots from file
data = np.load('test/names_onehots.npy', allow_pickle = True).item()
onehots = data['onehots']

#create model and load weights generated by train.py
model = createModel(onehots[0].shape)
checkpoint_path = "FCN_weights/cp.ckpt"
model.load_weights(checkpoint_path)

#predict label for test data
predictions = model.predict(onehots)

f = open('output_518030990014.txt', 'w')

#write header
f.write('Chemical,Label\n')

for i, v in enumerate(predictions):
    f.write(names[i] + ',%f\n' % v)   
f.close()
