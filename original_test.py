#source file for recovering the network model

import numpy as np
import tensorflow as tf
from original_train import createModel

#read names from file
names = np.genfromtxt("test/names_smiles.txt", dtype=str, delimiter = ',', skip_header = 1, usecols = (0))
    
#read onehots from file
data = np.load('test/names_onehots.npy', allow_pickle = True).item()
onehots = data['onehots']

#reshape onehots for input purpose
onehots = np.reshape(onehots, [len(onehots), 1, 73, 398])

#create model and load weights generated by train.py
model = createModel()
checkpoint_path = "original_weights/cp.ckpt"
model.load_weights(checkpoint_path)

#predict label for test data
predictions = model.predict(onehots)

f = open('output_518030990014.txt', 'w')

#write header
f.write('Chemical,Label\n')

#write predicted labels into output file
for i in range(len(predictions)):
    f.write(names[i]+',')
    f.write(str(np.argmax(predictions[i]))+"\n")

f.close()
